<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kategorier – Opskrift-Airfryer.dk</title>
<meta name="description" content="Se airfryer opskrifter efter kategori: kød, kylling, fisk, grønt, tilbehør, dessert og meget mere." />
<link rel="icon" href="/img/favicon.ico" />

<!-- AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7373148222153531" crossorigin="anonymous"></script>

<style>
/* Clean category page */
*,*::before,*::after{box-sizing:border-box}html,body{height:100%}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#0f172a;background:#fff;line-height:1.65}
a{text-decoration:none;color:inherit}img{max-width:100%;display:block}
:root{--max:1200px;--pad:16px;--text:#0f172a;--muted:#475569;--line:#e2e8f0;--soft:#f8fafc;--accent:#0ea5e9;--radius:14px;--shadow:0 8px 22px rgba(2,8,23,.06)}
.container{max-width:var(--max);margin:0 auto;padding:0 var(--pad)}
.hero{padding:22px 0 12px}
.kicker{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em}
h1{font-size:clamp(26px,3vw,38px);line-height:1.2;margin:6px 0 8px}
.lead{margin:0;color:var(--muted)}
.section{margin:24px 0}
.section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.section-head h2{font-size:22px;margin:0}
.grid{display:grid;gap:16px}
.grid-3{grid-template-columns:repeat(3,1fr)}
@media(max-width:900px){.grid-3{grid-template-columns:1fr 1fr}}
@media(max-width:560px){.grid-3{grid-template-columns:1fr}}
.card{border:1px solid var(--line);border-radius:14px;background:#fff;box-shadow:var(--shadow);overflow:hidden;display:block;transition:transform .06s ease}
.card:hover{transform:translateY(-2px)}
.thumb-icon{aspect-ratio:16/9;display:grid;place-items:center;background:linear-gradient(180deg,#f8fafc,#fff)}
.thumb-icon svg{width:54px;height:54px;color:var(--accent)}
.card-body{padding:12px 14px}
.card-body h3{font-size:15px;line-height:1.35;margin:0}
.meta{font-size:13px;color:var(--muted);margin-top:4px}
.adsbygoogle[data-ad-status="unfilled"]{display:none !important}
svg.hidden{position:absolute;width:0;height:0;overflow:hidden}
.badge{display:inline-block;background:#fff;border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-size:13px;margin-top:6px}

/* Underkategori chips */
.chips{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 0}
.chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;cursor:pointer;font-size:13px}
.chip:hover{transform:translateY(-1px)}
.chip[aria-current="true"]{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent) inset}
</style>
</head>
<body>

<!-- Ikoner + header -->
<div data-include="/partials/icons.html"></div>
<div data-include="/partials/header.html"></div>

<main class="container">
  <!-- HERO -->
  <section class="hero">
    <span class="kicker">Filtrér</span>
    <h1 id="kat-title">Kategori</h1>
    <p class="lead">Se opskrifter under den valgte kategori.</p>
    <span id="kat-badge" class="badge" style="display:none"></span>

    <!-- Underkategorier -->
    <div id="subcats" class="chips" aria-label="Underkategorier" hidden></div>
  </section>

  <!-- Annonce -->
  <div style="margin:8px 0 18px">
    <ins class="adsbygoogle" style="display:block"
         data-ad-client="ca-pub-7373148222153531"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
  </div>

  <!-- Grid -->
  <section class="section">
    <div class="section-head">
      <h2 id="kat-h2">Opskrifter</h2>
    </div>
    <div id="kategori-grid" class="grid grid-3"></div>
  </section>
</main>

<div data-include="/partials/footer.html"></div>
<script src="/assets/include.js?v=4"></script>
<script src="/assets/recipes.js?v=2"></script>
<script src="/assets/render-recipes.js?v=2"></script>

<!-- ===================== -->
<!--   B-MODEL SCRIPT FIX   -->
<!-- ===================== -->
<script>
(function(){
  const params = new URLSearchParams(location.search);

  // 1) Normal dansk slug
  const rawSlug = (params.get('slug') || '').trim();

  // 2) Normalizer (men uden at ændre æ/ø/å)
  const normalize = s =>
    s.toLowerCase().trim().replace(/\s+/g,' ').replace(/-+/g,'-');

  const wanted = normalize(rawSlug);

  // 3) Visningsnavn
  const nice =
    rawSlug.charAt(0).toUpperCase() + rawSlug.slice(1).replace(/-/g,' ');

  document.getElementById('kat-title').textContent = "Kategori: " + nice;
  document.getElementById('kat-h2').textContent = nice + " – Opskrifter";

  const badge = document.getElementById('kat-badge');
  badge.textContent = nice;
  badge.style.display = "inline-block";

  // 4) Hent opskrifter
  function getAllRecipes(){
    if (window.AFO && AFO.ready && typeof AFO.ready.then === 'function'){
      return AFO.ready.then(()=>AFO.getAll());
    }
    if (Array.isArray(window.RECIPES)) return Promise.resolve(window.RECIPES);
    return new Promise(res=>{
      window.addEventListener('load', ()=>res(Array.isArray(window.RECIPES)?window.RECIPES:[]));
    });
  }

  // 5) Matcher kategori MED danske tegn
  function matchesCategory(r){
    const catFields = [
      r.category, r.kategori, r.categoryName,
      ...(Array.isArray(r.categories) ? r.categories : [])
    ].filter(Boolean)
     .map(x => normalize(String(x)));

    const tagFields = Array.isArray(r.tags)
      ? r.tags.map(x => normalize(String(x)))
      : [];

    const all = [
      normalize(r.categorySlug || ''),
      ...catFields,
      ...tagFields
    ];

    if (!wanted) return true; // vis alle hvis ingen slug

    return all.includes(wanted);
  }

  // 6) Render opskrifter
  const grid = document.getElementById('kategori-grid');

  const card = r => `
    <a class="card" href="/opskrifter/${r.slug}.html">
      <div class="thumb-icon"><svg><use href="#${r.icon||'star'}"></use></svg></div>
      <div class="card-body">
        <h3>${r.title}</h3>
        ${r.meta ? `<p class="meta">${r.meta}</p>` : ''}
      </div>
    </a>
  `;

  getAllRecipes().then(list=>{
    const items = (list || []).filter(matchesCategory);

    grid.innerHTML = items.length
      ? items.map(card).join('')
      : `<p class="meta">Ingen opskrifter fundet i kategorien "${nice}".</p>`;
  }).catch(err=>{
    console.error("Kategori fejl:", err);
    grid.innerHTML = '<p class="meta">Kunne ikke hente opskrifter.</p>';
  });
})();
</script>

</body>
</html>
