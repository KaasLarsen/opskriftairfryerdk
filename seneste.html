<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Seneste Opskrifter – Opskrift-Airfryer.dk</title>
<meta name="description" content="Alle de nyeste airfryer opskrifter – søg efter kød, grønt, tilbehør, kager og meget mere." />
<link rel="icon" href="/img/favicon.ico" />
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7373148222153531" crossorigin="anonymous"></script>
<style>
*,*::before,*::after{box-sizing:border-box}html,body{height:100%}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#0f172a;background:#fff;line-height:1.6}
a{text-decoration:none;color:inherit}img{max-width:100%;display:block}
:root{--max:1200px;--pad:16px;--text:#0f172a;--muted:#475569;--line:#e2e8f0;--soft:#f8fafc;--accent:#ec4899;--accent-soft:#fce7f3;--radius:14px;--shadow:0 8px 22px rgba(2,8,23,.06)}
.container{max-width:var(--max);margin:0 auto;padding:0 var(--pad)}
.section{margin:18px 0}
.section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:12px;flex-wrap:wrap}
.section-head h1{font-size:26px;margin:0}
.tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center;width:100%}
.input{padding:14px 16px;border:2px solid var(--accent);border-radius:14px;min-width:260px;width:min(720px,100%);background:var(--accent-soft);font-size:18px;outline:none}
.input:focus{box-shadow:0 0 0 4px rgba(236,72,153,.15)}
.grid{display:grid;gap:16px}
.grid-3{grid-template-columns:repeat(3,1fr)}
@media(max-width:900px){.grid-3{grid-template-columns:1fr 1fr}}
@media(max-width:560px){.grid-3{grid-template-columns:1fr}}
.card{border:1px solid var(--line);border-radius:14px;background:#fff;box-shadow:var(--shadow);overflow:hidden;display:block;transition:transform .06s ease}
.card:hover{transform:translateY(-2px)}
.thumb{aspect-ratio:16/9;background:linear-gradient(180deg,#f8fafc,#fff)}
.card-body{padding:12px 14px}
.card-body h3{font-size:15px;line-height:1.35;margin:0}
.meta{font-size:13px;color:#64748b;margin-top:4px}
.copy{color:#64748b;font-size:13px;text-align:center;margin:26px 0 0}
.skel{height:180px;border:1px solid var(--line);border-radius:14px;background:linear-gradient(90deg,#f8fafc 25%,#eef2f7 37%,#f8fafc 63%);background-size:400% 100%;animation:shimmer 1.2s infinite}
@keyframes shimmer{0%{background-position:100% 0}100%{background-position:-100% 0}}
.adsbygoogle[data-ad-status="unfilled"]{display:none !important}
svg.hidden{position:absolute;width:0;height:0;overflow:hidden}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.toolbar-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
.results{font-size:13px;color:#64748b}
</style>
</head>
<body>
<div data-include="/partials/icons.html"></div>
<div data-include="/partials/header.html"></div>

<main class="container">
  <section class="section">
    <div class="section-head" style="flex-direction:column;align-items:flex-start">
      <h1>seneste opskrifter</h1>
      <div class="tools" role="search">
        <label class="sr-only" for="q">Søg i opskrifter</label>
        <input id="q" class="input" type="search" placeholder="Søg i opskrifter… (fx frikadeller, broccoli, brownies)" autocomplete="off" />
      </div>
    </div>

    <div style="margin:8px 0 18px">
      <ins class="adsbygoogle" style="display:block"
           data-ad-client="ca-pub-7373148222153531"
           data-ad-slot="1234567890"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
    </div>

    <div id="grid" class="grid grid-3" aria-live="polite">
      <div class="skel"></div><div class="skel"></div><div class="skel"></div>
    </div>

    <div class="toolbar-bottom">
      <p id="empty" class="copy" style="display:none">Ingen opskrifter matcher din søgning.</p>
      <div class="results" id="results">Indlæser…</div>
    </div>
  </section>
</main>

<div data-include="/partials/footer.html"></div>
<script src="/assets/include.js?v=4"></script>
<script>
const RECIPES_SITEMAP_URL = '/recipes-sitemap.xml';   // <— ny sitemap
const CACHE_KEY = 'RECIPES_CACHE_v1';
const CACHE_TTL_MS = 12 * 60 * 60 * 1000;

const grid = document.getElementById('grid');
const empty = document.getElementById('empty');
const resultsEl = document.getElementById('results');
const q = document.getElementById('q');

const debounce = (fn, ms=200) => { let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; };
const parseXML = t => new DOMParser().parseFromString(t,'application/xml');

function card(r){
  return `
    <a class="card" href="${r.slug}">
      <div class="thumb">${r.img ? `<img src="${r.img}" alt="" loading="lazy">` : ''}</div>
      <div class="card-body">
        <h3>${r.title}</h3>
        <p class="meta">${r.blurb}</p>
      </div>
    </a>`;
}

async function fetchMeta(url){
  try{
    const res = await fetch(url, { credentials: 'same-origin' });
    if(!res.ok) throw 0;
    const html = await res.text();
    const doc = new DOMParser().parseFromString(html,'text/html');
    const h1 = doc.querySelector('h1')?.textContent?.trim();
    const title = h1 || doc.querySelector('title')?.textContent?.trim() || url.split('/').pop().replace('.html','').replace(/-/g,' ');
    const blurb = doc.querySelector('meta[name="description"]')?.getAttribute('content')?.trim() || 'Se opskriften';
    const img = doc.querySelector('meta[property="og:image"]')?.getAttribute('content') || doc.querySelector('img')?.src || '';
    return { title, blurb, img };
  }catch{
    const t = url.split('/').pop().replace('.html','').replace(/-/g,' ');
    return { title: t, blurb: 'Se opskriften', img: '' };
  }
}

async function loadRecipes(){
  try{
    const cached = JSON.parse(localStorage.getItem(CACHE_KEY) || 'null');
    if(cached && (Date.now()-cached.ts) < CACHE_TTL_MS) return cached.items;
  }catch{}

  const res = await fetch(RECIPES_SITEMAP_URL, { credentials: 'same-origin' });
  const xml = parseXML(await res.text());
  const locs = Array.from(xml.querySelectorAll('url > loc')).map(n => n.textContent.trim());

  const urls = locs.filter(u => u.includes('/opskrifter/') && u.endsWith('.html'));
  const items = [];
  const concurrency = 12;
  let i = 0;
  async function worker(){
    while(i < urls.length){
      const href = urls[i++];
      const slug = new URL(href, location.origin).pathname;
      const m = await fetchMeta(slug);
      items.push({ slug, ...m });
    }
  }
  await Promise.all(Array.from({length: concurrency}, worker));
  items.sort((a,b)=> a.title.localeCompare(b.title,'da'));
  try{ localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Date.now(), items })); }catch{}
  return items;
}

function render(list){
  const term = (q.value||'').toLowerCase().trim();
  const out = term
    ? list.filter(r => (r.title||'').toLowerCase().includes(term) || (r.blurb||'').toLowerCase().includes(term))
    : list;
  resultsEl.textContent = `${out.length} resultat${out.length===1?'':'er'}`;
  if(out.length===0){ grid.innerHTML=''; empty.style.display='block'; }
  else{ grid.innerHTML = out.map(card).join(''); empty.style.display='none'; }
}

let ALL=[];
const onSearch = debounce(()=>render(ALL),150);
q.addEventListener('input', onSearch);
q.addEventListener('keydown', e=>{ if(e.key==='Escape'){ q.value=''; onSearch(); q.blur(); }});

(async function(){
  try{ ALL = await loadRecipes(); }catch{ ALL=[]; }
  render(ALL);
})();
</script>
</body>
</html>
