<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Opskrift-Airfryer.dk â€“ SprÃ¸de Airfryer Opskrifter</title>
<meta name="description" content="Nemme, sprÃ¸de og hurtige airfryer opskrifter pÃ¥ dansk â€“ tydelige tider og temperaturer." />
<link rel="icon" href="/img/favicon.ico" />
<!-- AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7373148222153531" crossorigin="anonymous"></script>

<style>
/* ====== Clean One-File Theme (Forside) ====== */
*,*::before,*::after{box-sizing:border-box}html,body{height:100%}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#0f172a;background:#fff;line-height:1.6}
a{text-decoration:none;color:inherit}img{max-width:100%;display:block}
:root{--max:1200px;--pad:16px;--text:#0f172a;--muted:#475569;--line:#e2e8f0;--soft:#f8fafc;--accent:#0ea5e9;--radius:14px;--shadow:0 8px 22px rgba(2,8,23,.06)}
.container{max-width:var(--max);margin:0 auto;padding:0 var(--pad)}

/* Header (via partials â€“ matcher opskrift-sider) */
.header{background:#fff;border-bottom:1px solid var(--line);box-shadow:0 2px 6px rgba(2,8,23,.04)}
.header-inner{max-width:var(--max);margin:0 auto;padding:12px var(--pad);display:flex;align-items:center;justify-content:space-between;gap:12px}
.logo{font-weight:800;color:#0ea5e9;font-size:20px}
.nav{display:flex;gap:18px;flex-wrap:wrap}
.nav a{font-size:15px;color:var(--text)}
.nav details.dropdown summary{list-style:none;cursor:pointer}
.nav details .menu{position:absolute;margin-top:8px;background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:var(--shadow);padding:8px 10px}
.nav details .menu a{display:block;padding:6px 8px;white-space:nowrap}

/* Hero â€“ strammet padding */
.hero{display:grid;grid-template-columns:1.25fr .75fr;gap:24px;align-items:center;padding:12px 0 6px}
@media(max-width:900px){.hero{grid-template-columns:1fr}}
.kicker{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em}
.hero h1{font-size:clamp(28px,3.2vw,40px);line-height:1.15;margin:6px 0 8px}
.hero p{margin:0;color:var(--muted)}
.hero-actions{display:flex;gap:10px;margin-top:14px}
.btn{display:inline-block;padding:10px 14px;border-radius:999px;font-weight:600;border:1px solid var(--line);background:#fff}
.btn.primary{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
.hero-box{background:linear-gradient(180deg,#fff,var(--soft));border:1px solid var(--line);border-radius:18px;min-height:230px;display:grid;place-items:center;box-shadow:var(--shadow)}
.hero-ico{width:120px;height:120px;color:var(--accent)}

/* Section */
.section{margin:18px 0}
.section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.section-head h2{font-size:22px;margin:0}
.more{font-size:14px;color:var(--muted);text-decoration:underline}

/* Cards & grids */
.grid{display:grid;gap:16px}
.grid-3{grid-template-columns:repeat(3,1fr)}
.grid-4{grid-template-columns:repeat(4,1fr)}
@media(max-width:900px){.grid-3{grid-template-columns:1fr 1fr}.grid-4{grid-template-columns:1fr 1fr}}
@media(max-width:560px){.grid-3,.grid-4{grid-template-columns:1fr}}
.card{border:1px solid var(--line);border-radius:14px;background:#fff;box-shadow:var(--shadow);overflow:hidden;display:block;transition:transform .06s ease}
.card:hover{transform:translateY(-2px)}
.thumb-icon{aspect-ratio:16/9;display:grid;place-items:center;background:linear-gradient(180deg,#f8fafc,#fff)}
.thumb-icon svg{width:54px;height:54px;color:#0ea5e9}
.card-body{padding:12px 14px}
.card-body h3{font-size:15px;line-height:1.35;margin:0}
.meta{font-size:13px;color:var(--muted);margin-top:4px}

/* Category tiles */
.cat{display:grid;place-items:center;text-align:center;padding:16px;border:1px solid var(--line);border-radius:14px;background:#fff;box-shadow:var(--shadow)}
.cat svg{width:38px;height:38px;color:#0ea5e9;margin-bottom:8px}
.cat span{font-weight:600}

/* Guides */
.guide{display:block;border:1px solid var(--line);border-radius:14px;background:#fff;box-shadow:var(--shadow);padding:14px}
.guide h3{margin:0 0 6px;font-size:16px}
.guide p{margin:0;color:#475569;font-size:14px}

/* Newsletter */
.news{border:1px solid var(--line);border-radius:14px;padding:16px;background:#fff;box-shadow:var(--shadow);display:grid;grid-template-columns:1fr auto;gap:14px;align-items:center}
@media(max-width:700px){.news{grid-template-columns:1fr}}
.news form{display:flex;align-items:center;gap:8px}
.news input{padding:10px 12px;border:1px solid var(--line);border-radius:10px;width:100%;flex:1 1 auto}
.news button.btn{white-space:nowrap}

/* Carousel (PriceRunner) */
.pr-carousel{position:relative}
.pr-slide{display:none}
.pr-slide.is-active{display:block}
.pr-nav{position:absolute;top:50%;transform:translateY(-50%);border:1px solid var(--line);background:#fff;border-radius:999px;width:36px;height:36px;display:grid;place-items:center;box-shadow:var(--shadow);cursor:pointer}
.pr-prev{left:8px}
.pr-next{right:8px}
.pr-dots{display:flex;gap:8px;justify-content:center;margin-top:8px}
.pr-dot{width:8px;height:8px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer}
.pr-dot.is-active{background:#0ea5e9;border-color:#0ea5e9}

/* Footer */
.footer{background:#f8fafc;border-top:1px solid var(--line);margin-top:24px}
.footer-inner{max-width:var(--max);margin:0 auto;padding:28px var(--pad)}
.footer-cols{display:grid;grid-template-columns:2fr 1fr 1fr;gap:24px;margin-bottom:16px}
.copy{color:#64748b;font-size:13px;text-align:center}
@media(max-width:900px){.footer-cols{grid-template-columns:1fr}}

/* Misc */
svg.hidden{position:absolute;width:0;height:0;overflow:hidden}
.adsbygoogle[data-ad-status="unfilled"]{display:none !important}
html{scroll-behavior:smooth}
</style>
</head>
<body>

<!-- Partials (SKAL ligge inde i <body>) -->
<div data-include="/partials/icons.html"></div>
<div data-include="/partials/header.html"></div>

<!-- BLACK FRIDAY TOPBAR (placeres lige under header) -->
<div style="background:#0ea5e9;color:#fff">
  <div class="container" style="padding:8px 0;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap">
    <span style="font-weight:600">ðŸ”¥ Black Friday 2025: Se bedste airfryer-tilbud</span>
    <a href="/black-friday-airfryer-tilbud.html" style="background:#fff;color:#0ea5e9;padding:6px 10px;border-radius:999px;font-weight:700;border:1px solid rgba(2,8,23,.08)">GÃ¥ til deals</a>
  </div>
</div>

<main class="container">
  <!-- HERO -->
  <section class="hero">
    <div>
      <span class="kicker">Danske Airfryer Opskrifter</span>
      <h1>SprÃ¸de Airfryer Opskrifter â€“ Nemt Og Hurtigt</h1>
      <p>Tydelige Tider, Temperaturer Og Trin-For-Trin. Mindre Opvask, Mere SprÃ¸dhed.</p>
      <div class="hero-actions">
        <a class="btn primary" href="#populaere">Se PopulÃ¦re</a>
        <a class="btn" href="/seneste.html">Se Seneste</a>
      </div>
    </div>
    <div class="hero-box">
      <img src="/img/logo.png" alt="Opskrift-Airfryer.dk" class="hero-ico" style="width:120px;height:auto" />
    </div>
  </section>

  <!-- Annonce -->
  <div style="margin:8px 0 18px">
    <ins class="adsbygoogle" style="display:block"
         data-ad-client="ca-pub-7373148222153531"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
  </div>

  <!-- SÃ¸gefelt (sender til seneste.html) -->
  <section class="section" style="margin:36px 0">
    <div style="max-width:700px;margin:0 auto">
      <form id="search-form" onsubmit="event.preventDefault(); doSearch();"
            style="display:flex;align-items:center;gap:8px;background:#fff0f5;padding:16px 18px;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow)">
        <input id="search-input" type="text" placeholder="ðŸ” SÃ¸g efter opskrifter..."
               style="flex:1;padding:10px 14px;border:1px solid var(--line);border-radius:10px;font-size:15px" />
        <button class="btn primary" type="submit">SÃ¸g</button>
      </form>
    </div>
  </section>
  <script>
    function doSearch(){
      const q = document.getElementById('search-input').value.trim();
      if(q){ window.location.href = "/seneste.html?soeg=" + encodeURIComponent(q); }
    }
  </script>

  <!-- PopulÃ¦re -->
  <section id="populaere" class="section">
    <div class="section-head">
      <h2>PopulÃ¦re Opskrifter</h2>
      <a class="more" href="/seneste.html">Se Seneste</a>
    </div>
    <div class="grid grid-3">
      <a class="card" href="/opskrifter/flaeskesteg-i-airfryer.html">
        <div class="thumb-icon"><svg><use href="#pig"></use></svg></div>
        <div class="card-body"><h3>FlÃ¦skesteg I Airfryer â€“ SprÃ¸d SvÃ¦r</h3><p class="meta">45â€“60 Min Â· Nemt</p></div>
      </a>
      <a class="card" href="/opskrifter/frikadeller-i-airfryer.html">
        <div class="thumb-icon"><svg><use href="#pig"></use></svg></div>
        <div class="card-body"><h3>Frikadeller I Airfryer â€“ Klassikeren</h3><p class="meta">25 Min Â· Familiehit</p></div>
      </a>
      <a class="card" href="/opskrifter/kyllingelaar-i-airfryer.html">
        <div class="thumb-icon"><svg><use href="#chicken"></use></svg></div>
        <div class="card-body"><h3>KyllingelÃ¥r I Airfryer â€“ Saftige</h3><p class="meta">22â€“28 Min Â· Protein</p></div>
      </a>
    </div>
  </section>

  <!-- Kategorier -->
  <section class="section">
    <div class="section-head">
      <h2>Kategorier</h2>
      <a class="more" href="/kategori.html">Se Alle</a>
    </div>
    <div class="grid grid-4">
   <a class="cat" href="/kategori.html?slug=svinekod"><svg><use href="#pig"></use></svg><span>SvinekÃ¸d</span></a>
  <a class="cat" href="/kategori.html?slug=kylling"><svg><use href="#chicken"></use></svg><span>Kylling</span></a>
  <a class="cat" href="/kategori.html?slug=groent"><svg><use href="#leaf"></use></svg><span>GrÃ¸nt</span></a>
    <a class="cat" href="/kategori.html?slug=tilbehoer"><svg><use href="#fries"></use></svg><span>TilbehÃ¸r</span></a>
</div>
  </section>

  <!-- Seneste -->
  <section id="seneste" class="section">
    <div class="section-head">
      <h2>Seneste Opskrifter</h2>
      <a class="more" href="/seneste.html">Se Alle</a>
    </div>
    <div id="seneste-grid" class="grid grid-3">
      <p class="meta">IndlÃ¦serâ€¦</p>
    </div>
  </section>

  <!-- Guides & Tips -->
  <section class="section">
    <div class="section-head">
      <h2>Guides & Tips</h2>
      <a class="more" href="/guides.html">Se Alle</a>
    </div>
    <div class="grid grid-3">
      <a class="guide" href="/guides/airfryer-tider.html"><h3>Airfryer Tider & Temperaturer (Cheat Sheet)</h3><p>Hvor lÃ¦nge skal kylling, kartofler og grÃ¸nt have? FÃ¥ overblik.</p></a>
      <a class="guide" href="/guides/valg-af-airfryer.html"><h3>VÃ¦lg Den Rigtige Airfryer</h3><p>StÃ¸rrelse, effekt, kurv vs. skuffe â€“ og det bedste tilbehÃ¸r.</p></a>
      <a class="guide" href="/guides/airfryer-rengoering.html"><h3>RengÃ¸ring Af Airfryer</h3><p>SkÃ¥nsom rengÃ¸ring af kurv, rist og varmelegeme â€“ uden ridser.</p></a>
    </div>
  </section>

  <!-- Anbefalede (carousel) -->
  <section class="section" id="anbefalede">
    <div class="section-head">
      <h2>Anbefalede tilbud</h2>
    </div>

    <div class="pr-carousel" id="pr-carousel">
      <!-- SLIDE 1 -->
      <div class="pr-slide is-active">
        <div style="min-height:220px">
          <div id="pr-product-widget-e0348930" style="display:block;width:100%"></div>
          <script src="https://api.pricerunner.com/publisher-widgets/dk/product.js?onlyInStock=true&offerOrigin=NATIONAL&offerLimit=3&productId=3280146314&partnerId=adrunner_dk_opskrift-airfryer&widgetId=pr-product-widget-e0348930" async></script>
        </div>
        <div style="display:inline-block;margin-top:6px">
          <a href="https://www.pricerunner.dk/pl/81-3280146314/Frituregryder/Ninja-Double-Stack-XL-2-Level-Air-Fryer-9.5L-Sammenlign-Priser" rel="nofollow">
            <p style="font:14px 'Klarna Text',Helvetica,sans-serif;font-style:italic;color:var(--muted);text-decoration:underline">
              Annonce i samarbejde med <span style="font-weight:bold">PriceRunner</span>
            </p>
          </a>
        </div>
      </div>

      <!-- SLIDE 2 -->
      <div class="pr-slide">
        <div style="min-height:220px">
          <div id="pr-product-widget-f262c590" style="display:block;width:100%"></div>
          <script src="https://api.pricerunner.com/publisher-widgets/dk/product.js?onlyInStock=true&offerOrigin=NATIONAL&offerLimit=3&productId=3200256729&partnerId=adrunner_dk_opskrift-airfryer&widgetId=pr-product-widget-f262c590" async></script>
        </div>
        <div style="display:inline-block;margin-top:6px">
          <a href="https://www.pricerunner.dk/pl/81-3200256729/Frituregryder/Xiaomi-Mi-Smart-Air-Fryer-Sammenlign-Priser" rel="nofollow">
            <p style="font:14px 'Klarna Text',Helvetica,sans-serif;font-style:italic;color:var(--muted);text-decoration:underline">
              Annonce i samarbejde med <span style="font-weight:bold">PriceRunner</span>
            </p>
          </a>
        </div>
      </div>

      <!-- SLIDE 3 -->
      <div class="pr-slide">
        <div style="min-height:220px">
          <div id="pr-product-widget-0a362ae0" style="display:block;width:100%"></div>
          <script src="https://api.pricerunner.com/publisher-widgets/dk/product.js?onlyInStock=true&offerOrigin=NATIONAL&offerLimit=3&productId=3231353404&partnerId=adrunner_dk_opskrift-airfryer&widgetId=pr-product-widget-0a362ae0" async></script>
        </div>
        <div style="display:inline-block;margin-top:6px">
          <a href="https://www.pricerunner.dk/pl/81-3231353404/Frituregryder/Philips-3000-Series-NA352-00-Sammenlign-Priser" rel="nofollow">
            <p style="font:14px 'Klarna Text',Helvetica,sans-serif;font-style:italic;color:var(--muted);text-decoration:underline">
              Annonce i samarbejde med <span style="font-weight:bold">PriceRunner</span>
            </p>
          </a>
        </div>
      </div>

      <!-- Navigation -->
      <button class="pr-nav pr-prev" aria-label="Forrige">â€¹</button>
      <button class="pr-nav pr-next" aria-label="NÃ¦ste">â€º</button>
    </div>

    <!-- Dots -->
    <div class="pr-dots" id="pr-dots"></div>
  </section>

  <!-- Slider logik med autoplay -->
  <script>
  (function(){
    const root = document.getElementById('pr-carousel');
    if(!root) return;
    const slides = Array.from(root.querySelectorAll('.pr-slide'));
    const prev = root.querySelector('.pr-prev');
    const next = root.querySelector('.pr-next');
    const dotsWrap = document.getElementById('pr-dots');

    if (slides.length <= 1) return;

    let i = Math.max(0, slides.findIndex(s=>s.classList.contains('is-active')));
    let timer = null;
    const INTERVAL = 6000; // 6 sek

    function show(n){
      slides.forEach(s=>s.classList.remove('is-active'));
      slides[n].classList.add('is-active');
      if (dotsWrap){
        dotsWrap.querySelectorAll('.pr-dot').forEach((d,k)=>d.classList.toggle('is-active', k===n));
      }
      i = n;
    }

    function makeDots(){
      if(!dotsWrap) return;
      dotsWrap.innerHTML = slides.map((_,k)=>`<button class="pr-dot" aria-label="Slide ${k+1}"></button>`).join('');
      dotsWrap.querySelectorAll('.pr-dot').forEach((btn,k)=>btn.addEventListener('click', ()=>{
        stop(); show(k); start();
      }));
    }

    function nextSlide(){ show((i+1) % slides.length); }
    function prevSlide(){ show((i-1+slides.length) % slides.length); }

    function start(){
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      stop();
      timer = setInterval(nextSlide, INTERVAL);
    }
    function stop(){
      if (timer){ clearInterval(timer); timer = null; }
    }

    prev && prev.addEventListener('click', ()=>{ stop(); prevSlide(); start(); });
    next && next.addEventListener('click', ()=>{ stop(); nextSlide(); start(); });

    root.addEventListener('mouseenter', stop);
    root.addEventListener('mouseleave', start);
    root.addEventListener('focusin', stop);
    root.addEventListener('focusout', start);

    document.addEventListener('visibilitychange', ()=>{
      if (document.hidden) stop(); else start();
    });

    makeDots();
    show(i);
    start();
  })();
  </script>
</main>

<!-- Footer via partial (med lille fallback hvis include.js fejler) -->
<div data-include="/partials/footer.html">
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-cols">
        <div><strong>Opskrift-Airfryer.dk</strong><br><span class="meta">Nemme, sprÃ¸de og hurtige airfryer opskrifter.</span></div>
        <div><a href="/seneste.html">Seneste</a><br><a href="/kategori.html">Kategorier</a></div>
        <div><a href="/kontakt.html">Kontakt</a><br><a href="/cookies.html">Cookies</a></div>
      </div>
      <p class="copy">Â© Opskrift-Airfryer.dk</p>
    </div>
  </footer>
</div>

<!-- Partials loader -->
<script defer src="/assets/include.js?v=4"></script>

<!-- DATA + RENDER: Seneste -->
<script src="/assets/recipes.js?v=20"></script>
<script>
(function(){
  const mount = document.getElementById('seneste-grid');
  const iconSvg = id => '<div class="thumb-icon"><svg><use href="#'+(id||'star')+'"></use></svg></div>';
  const card = r => [
    '<a class="card" href="/opskrifter/'+r.slug+'.html">',
      iconSvg(r.icon),
      '<div class="card-body"><h3>'+r.title+'</h3>',
        r.meta ? '<p class="meta">'+r.meta+'</p>' : '',
      '</div>',
    '</a>'
  ].join('');

  function renderLatest(n, list){
    const items = (list||[]).slice(0, n);
    mount.innerHTML = items.length ? items.map(card).join('') : '<p class="meta">Ingen opskrifter fundet.</p>';
  }

  if (window.AFO && AFO.ready && typeof AFO.ready.then === 'function'){
    AFO.ready.then(()=> renderLatest(6, AFO.getAll()))
             .catch(()=> mount.innerHTML = '<p class="meta">Kunne ikke hente opskrifter.</p>');
  } else {
    window.addEventListener('load', ()=> renderLatest(6, (window.RECIPES||[])));
  }
})();
</script>
  <!-- AUTOSUGGEST: CSS -->
<style>
  .as-layer{position:absolute;z-index:9999;background:#fff;border:1px solid #e2e8f0;border-radius:12px;box-shadow:0 10px 30px rgba(2,8,23,.08);overflow:hidden;max-height:340px;display:none}
  .as-list{list-style:none;margin:0;padding:6px 0;max-height:340px;overflow:auto}
  .as-item{display:flex;align-items:center;gap:10px;padding:10px 12px;cursor:pointer;font-size:14px;line-height:1.3}
  .as-item small{color:#64748b}
  .as-item svg{width:18px;height:18px;opacity:.9}
  .as-item:hover,.as-item.is-active{background:#f8fafc}
  .as-empty{padding:10px 12px;color:#64748b;font-size:13px}
</style>

<!-- AUTOSUGGEST: JS -->
<script>
(function(){
  const INPUT = document.querySelector('#site-search, #q');
  if(!INPUT) return;

  const SITEMAPS = ['/recipes-sitemap.xml','/guides-sitemap.xml','/airfryer-guides-sitemap.xml'];
  const CACHE_KEY = 'SITE_INDEX_v1';
  const TTL = 12*60*60*1000; // 12h
  const MAX_SUGGEST = 6;

  // floating layer
  const layer = document.createElement('div');
  layer.className = 'as-layer';
  layer.innerHTML = '<ul class="as-list" role="listbox" id="as-list"></ul>';
  document.body.appendChild(layer);
  const listEl = layer.querySelector('#as-list');

  // helpers
  const norm = s => (s||'')
    .toLowerCase()
    .normalize('NFD').replace(/\p{Diacritic}/gu,'') // fjerner accent
    .replace(/Ã¦/g,'ae').replace(/Ã¸/g,'oe').replace(/Ã¥/g,'aa');
  const titleFromSlug = href => {
    const name = href.replace(/\.html$/,'').split('/').pop().replace(/-/g,' ');
    return name.replace(/\b\w/g,m=>m.toUpperCase());
  };
  const typeFromPath = p => p.startsWith('/guides/') ? 'Guide' : 'Opskrift';

  function positionLayer(){
    const r = INPUT.getBoundingClientRect();
    layer.style.left = (r.left + window.scrollX) + 'px';
    layer.style.top  = (r.bottom + window.scrollY + 6) + 'px';
    layer.style.width= r.width + 'px';
  }
  function show(){ positionLayer(); layer.style.display='block'; }
  function hide(){ layer.style.display='none'; ACTIVE = -1; }
  function isShown(){ return layer.style.display === 'block'; }

  // load index (from cache or sitemaps)
  async function getIndex(){
    try{
      const c = JSON.parse(localStorage.getItem(CACHE_KEY) || 'null');
      if (c && (Date.now()-c.ts) < TTL && Array.isArray(c.items)) return c.items;
    }catch(_){}
    const items = [];
    for (const url of SITEMAPS){
      try{
        const res = await fetch(url, {cache:'no-store'});
        if(!res.ok) continue;
        const xml = await res.text();
        const locs = [...xml.matchAll(/<loc>\s*([^<]+)\s*<\/loc>/g)].map(m=>m[1]);
        locs.forEach(u=>{
          try{
            const p = new URL(u, location.origin).pathname;
            if (!p.endsWith('.html')) return;
            if (!(p.startsWith('/opskrifter/') || p.startsWith('/guides/'))) return;
            items.push({ url: p, title: titleFromSlug(p), type: typeFromPath(p), key: norm(titleFromSlug(p)) });
          }catch(_){}
        });
      }catch(_){}
    }
    // dedup
    const seen = new Set(); const dedup = [];
    for (const it of items){ if(!seen.has(it.url)){ seen.add(it.url); dedup.push(it);} }
    dedup.sort((a,b)=> a.title.localeCompare(b.title,'da'));
    try{ localStorage.setItem(CACHE_KEY, JSON.stringify({ts:Date.now(), items:dedup})); }catch(_){}
    return dedup;
  }

  function score(item, q){
    if (!q) return 0;
    const i = item.key.indexOf(q);
    if (i === 0) return 200 - item.title.length;      // starter med -> hÃ¸jt
    if (i > 0)  return 100 - i;                       // indeholder -> mellem
    return -1;                                        // ikke match
  }

  let INDEX = [], ACTIVE = -1;

  function render(matches){
    if (!matches.length){
      listEl.innerHTML = `<li class="as-empty">Ingen forslag</li>`;
      show(); return;
    }
    listEl.innerHTML = matches.map((m,idx)=>`
      <li class="as-item" role="option" data-idx="${idx}">
        <svg><use href="${m.type==='Guide' ? '#star' : '#book'}"></use></svg>
        <div><div>${m.title}</div><small>${m.type}</small></div>
      </li>
    `).join('');
    show();
  }

  function select(idx){
    const items = [...listEl.querySelectorAll('.as-item')];
    items.forEach(el=>el.classList.remove('is-active'));
    if (idx>=0 && idx<items.length){
      items[idx].classList.add('is-active');
      ACTIVE = idx;
    } else {
      ACTIVE = -1;
    }
  }

  function follow(idx, matches, term){
    if (idx >= 0 && matches[idx]) {
      location.href = matches[idx].url;
    } else {
      // fallback til jeres eksisterende sÃ¸gning
      const target = '/seneste.html?q=' + encodeURIComponent(term);
      location.href = target;
    }
  }

  // wire up
  let ready = false;
  getIndex().then(items => { INDEX = items; ready = true; });

  INPUT.setAttribute('autocomplete','off');

  INPUT.addEventListener('input', () => {
    const raw = INPUT.value.trim();
    if (!raw){ hide(); return; }
    if (!ready) return;
    const q = norm(raw);
    const matches = INDEX
      .map(it => ({...it, _s: score(it, q)}))
      .filter(it => it._s >= 0)
      .sort((a,b)=> b._s - a._s)
      .slice(0, MAX_SUGGEST);
    render(matches);

    // mouse interactions
    listEl.querySelectorAll('.as-item').forEach((el, i) => {
      el.addEventListener('mousemove',()=>select(i));
      el.addEventListener('mousedown',(e)=>{ e.preventDefault(); follow(i, matches, raw); });
    });
  });

  INPUT.addEventListener('focus', () => { if (INPUT.value.trim()) positionLayer(); });
  window.addEventListener('resize', () => { if (isShown()) positionLayer(); });
  window.addEventListener('scroll', () => { if (isShown()) positionLayer(); }, true);

  document.addEventListener('click', (e)=>{
    if (e.target === INPUT || layer.contains(e.target)) return;
    hide();
  });

  INPUT.addEventListener('keydown', (e)=>{
    const items = listEl.querySelectorAll('.as-item');
    if (e.key === 'ArrowDown'){
      e.preventDefault(); if(!items.length) return;
      select( ACTIVE < items.length-1 ? ACTIVE+1 : 0 );
    } else if (e.key === 'ArrowUp'){
      e.preventDefault(); if(!items.length) return;
      select( ACTIVE > 0 ? ACTIVE-1 : items.length-1 );
    } else if (e.key === 'Enter'){
      const raw = INPUT.value.trim();
      const q = norm(raw);
      const matches = INDEX
        .map(it => ({...it, _s: score(it, q)}))
        .filter(it => it._s >= 0)
        .sort((a,b)=> b._s - a._s)
        .slice(0, MAX_SUGGEST);
      follow(ACTIVE, matches, raw);
    } else if (e.key === 'Escape'){
      hide();
    }
  });
})();
</script>
</body>
</html>
